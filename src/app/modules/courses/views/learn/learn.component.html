<section class="lerning-header">
  <div class="header-container">
    <div *ngIf="course" class="course-title focus-outline" [routerLink]="['/courses', course.id]">{{ course.name }}</div>
  </div>
</section>

<div class="column-container">
  <div class="content-container">
    <div class="content">
      <router-outlet></router-outlet>
    </div>
    <div class="navigation-container">
      <div>
        <div *ngIf="showPrevButton" class="navigation-button" tabindex="0" (click)="goToPrevLesson()">
          <i class="material-icons">keyboard_arrow_left</i>
          <div class="navigation-label">Previous lesson</div>
        </div>
      </div>
      <div>
        <div *ngIf="showNextButton" class="navigation-button" tabindex="0" (click)="goToNextLesson()">
          <div class="navigation-label">Next lesson</div>
          <i class="material-icons">keyboard_arrow_right</i>
        </div>
      </div>
    </div>
    <div class="tabs-container">
      <a
        class="tab-selector focus-outline"
        [class.active]="currentTab === 'about'"
        (click)="currentTab = 'about'"
        (keyup.enter)="currentTab = 'about'"
        tabindex="0"
      >
        About
      </a>
      <a
        class="tab-selector focus-outline"
        [class.active]="currentTab === 'lessons'"
        (click)="currentTab = 'lessons'"
        (keyup.enter)="currentTab = 'lessons'"
        tabindex="0"
      >
        Lessons
      </a>
      <a
        class="tab-selector focus-outline"
        [class.active]="currentTab === 'reviews'"
        (click)="currentTab = 'reviews'"
        (keyup.enter)="currentTab = 'reviews'"
        tabindex="0"
      >
        Reviews
      </a>
      <a
        class="tab-selector focus-outline"
        [class.active]="currentTab === 'certificate'"
        (click)="currentTab = 'certificate'"
        (keyup.enter)="currentTab = 'certificate'"
        tabindex="0"
      >
        Certificate
      </a>
    </div>
    <div class="tab-content-container">
      <!-- About tab content -->
      <div *ngIf="currentTab === 'about'" class="tab tab-about">
        <div class="description-title">Description</div>
        <div *ngIf="course" class="description-content" [innerHTML]="course.overview"></div>
      </div>
      <!-- Lessons tab content -->
      <div *ngIf="currentTab === 'lessons'" class="tab tab-lessons">
        <div class="lessons-title">{{ course.lessons.length }} lessons</div>
        <div class="lessons-container">
          <div
            class="lesson-card"
            *ngFor="let lesson of course.lessons; let i = index"
          >
            <app-lesson-card
              [lesson]="lesson"
              [lessonNumber]="i + 1"
              [enrolled]="true"
              (navigateToLesson)="navigateToLesson($event)"
            ></app-lesson-card>
          </div>
        </div>
      </div>
      <!-- Reviews tab content -->
      <div *ngIf="currentTab === 'reviews'" class="tab tab-reviews">
        <div class="reviews-title-container">
          <div *ngIf="course.totalReviews" class="reviews-title">{{ course.totalReviews }} reviews</div>
          <div *ngIf="!(course.totalReviews) || course.totalReviews === 0" class="reviews-title">0 reviews</div>
        </div>
        <div *ngIf="reviews && reviews.length > 0">
          <cdk-virtual-scroll-viewport
            class="virtual-scroll-viewport nice-container-scroll"
            itemSize="161"
            (scrolledIndexChange)="nextBatch($event, reviews.length)"
          >
            <div class="review-card animated slideInRight" *cdkVirtualFor="let review of reviews; let i = index; trackBy: trackByIdx">
              <app-review-card [review]="review"></app-review-card>
            </div>
          </cdk-virtual-scroll-viewport>
        </div>
        <div *ngIf="!reviews || reviews.length === 0" class="reviews-container-2">
          <div class="no-review-cards-container-2">
            <i class="material-icons">inbox</i>
            <div class="no-reviews-phrase">This course has no reviews</div>
          </div>
        </div>
        <div *ngIf="canRateCourse" class="rate-container">
          <button mat-raised-button [color]="'accent'" (click)="onRateCourse()">Rate this course</button>
        </div>
      </div>
      <!-- Certificate tab content -->
      <div
        *ngIf="currentTab === 'certificate' && showCertificate"
        class="tab tab-certificate"
      >
        <div class="certificate-wrapper">
          <div id="certificate" class="certificate">
            <div class="certificate-container">
              <img alt="Invest Naija Logotype" class="logotype" src="/assets/img/logos/logotype-certificate.svg">
              <div class="certificate-label">certificate</div>
              <div class="awarded-container">
                <div class="line"></div>
                <div class="awarded-label">this certificate is awarded to</div>
                <div class="line"></div>
              </div>
              <div class="name">
                <div class="user-names">{{user.name}} {{user.lastName}}</div>
                <div class="line name-line"></div>
              </div>
              <div class="course-details">
                <div class="course-data course-category">
                  <div class="course-data-label">course category:</div>
                  <div class="course-data-input">
                    <div class="course-value">{{course.category.name}}</div>
                    <div class="input-line"></div>
                  </div>
                </div>
                <div class="course-data course-name">
                  <div class="course-data-label">course name:</div>
                  <div class="course-data-input">
                    <div class="course-value">{{course.name}}</div>
                    <div class="input-line"></div>
                  </div>
                </div>
                <div class="course-data course-date">
                  <div class="course-data-label">date:</div>
                  <div class="course-data-input">
                    <div class="course-value">{{course.category.createdAt}}</div>
                    <div class="input-line"></div>
                  </div>
                </div>
                <div class="course-data course-url">
                  <div class="course-data-label">url:</div>
                  <div class="course-data-input">
                    <div class="course-value">https://investnaija.com/courses/{{course.id}}</div>
                    <div class="input-line"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <button class="download-certificate-button focus-outline" (click)="onDownloadCertificate()">Download certificate</button>
    </div>
    <div
      *ngIf="currentTab === 'certificate' && !showCertificate"
      class="tab tab-no-certificate"
    >
      <div class="reviews-container no-certificate">
        <i class="material-icons">inbox</i>
        <div class="complete-phrase">Complete this course to download your certificate</div>
      </div>
    </div>
    </div>
  </div>
  <div class="sidebar-container">
    <div class="sidebar">
      <div class="sidebar-header">Course content</div>
      <div *ngIf="course && course.lessons && course.lessons.length > 0" class="lesson-card-container">
        <div *ngFor="let lesson of course.lessons; let i = index">
          <div class="lesson-container">
            <div class="left">
              <i *ngIf="lessonCompleted(lesson.id)" class="material-icons">
                check_box
              </i>
              <i *ngIf="!lessonCompleted(lesson.id)" class="material-icons">
                check_box_outline_blank
              </i>
            </div>
            <div class="middle">
              <div class="number-title-container">
                <div>.{{ i + 1 }}</div>
                <a [routerLink]="['./lesson', lesson.id]"  routerLinkActive="active">{{ lesson.title }}</a>
              </div>
              <div class="type-duration-container">
                <div class="type">
                  <i *ngIf="lesson.type === 'DOCUMENT'" class="material-icons">
                    insert_drive_file
                  </i>
                  <i *ngIf="lesson.type === 'ARTICLE'" class="material-icons">
                    subject
                  </i>
                  <i *ngIf="lesson.type === 'VIDEO'" class="material-icons">
                    play_circle_outline
                  </i>
                </div>
                <div class="duration">
                  <div *ngIf="lesson.type === 'VIDEO'" class="lesson-duration">
                    {{ lesson.fileDuration | readTime }}
                    <i class="material-icons">
                      access_time
                    </i>
                  </div>
                  <div *ngIf="lesson.type !== 'VIDEO'" class="lesson-readtime">
                    {{ lesson.readTime | readTime }}
                    <i class="material-icons">
                      menu_book
                    </i>
                  </div>
                </div>
              </div>
            </div>
            <div class="right"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<section *ngIf="relatedCourses && relatedCourses.length > 0" class="courses-section">
  <div class="courses-container">
    <div class="title-container">
      <div class="title">You might also be interested in</div>
      <a>View all</a>
    </div>
    <div class="cards-container">
      <div
        class="course-card"
        *ngFor="let course of relatedCourses; let i = index"
      >
        <app-course-card [course]="course"></app-course-card>
      </div>
    </div>
  </div>
</section>
